<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="./js/jquery-3.5.1.min.js"></script>
    <style>
      /* //è‰²å½©å˜é‡ */
      :root {
        --elevatorBorderColor--: rgba(0, 0, 0.85);
        --elevatorBtnBgColor--: #fff;
        --elevatorBtnBgDisabledColor--: #898989;
        --elevatorBtnDisabledColor--: #c2c3c4;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      .ew-elevator-building {
        position: relative;
        width: 350px;
        max-width: 100%;
        min-height: 500px;
        border: 6px solid var(--elevatorBorderColor--);
        margin: 3vh auto;
        overflow: hidden;
        display: flex;
      }
      /* ç”µæ¢¯äº•ï¼Œä¸»è¦å°±æ˜¯è®¾ç½®ç›¸å¯¹å®šä½å’Œè¾¹æ¡†ï¼Œå›ºå®šå®½åº¦ */
      .ew-elevator-shaft {
        overflow: hidden;
        border-right: 2px solid var(--elevatorBorderColor--);
        width: 200px;
        padding: 1px;
        position: relative;
      }
      .ew-elevator {
        height: 98px;
        width: calc(100% - 2px);
        background: #eee;
        border: 1px solid var(--elevatorBorderColor--);
        padding: 1px;
        transition-timing-function: ease-in-out;
        position: absolute;
        left: 1px;
        bottom: 1px;
        transition-property: all;
        transition-duration: 0.2s;
        transition-timing-function: linear;
        transition-delay: 0s;
      }
      .ew-elevator-door {
        transition-property: all;
        transition-duration: 0.2s;
        transition-timing-function: linear;
        transition-delay: 0s;
        position: absolute;
        width: 50%;
        height: 100%;
        background-color: var(--elevatorBorderColor--);
        border: 1px solid var(--elevatorBtnBgColor--);
        top: 0;
      }

      .ew-elevator-left-door {
        left: 0;
      }

      .ew-elevator-right-door {
        right: 0;
      }
      .ew-elevator-left-door.toggle {
        animation: doorLeft 3s 1s cubic-bezier(0.075, 0.82, 0.165, 1);
      }

      .ew-elevator-right-door.toggle {
        animation: doorRight 3s 1s cubic-bezier(0.075, 0.82, 0.165, 1);
      }
      /* //æ¥¼å±‚å®¹å™¨å…ƒç´  */
      .ew-elevator-storey-zone {
        width: auto;
        height: 100%;
      }
      /* //æ¥¼å±‚å…ƒç´  */
      .ew-elevator-storey {
        display: flex;
        align-items: center;
        height: 98px;
        border-bottom: 1px solid var(--elevatorBorderColor--);
      }
      .ew-elevator-controller {
        width: 70px;
        height: 98px;
        padding: 8px 0;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
      }
      /* //ç”µæ¢¯æŒ‰é’® */
      .ew-elevator-btn {
        width: 36px;
        height: 36px;
        border: 1px solid var(--elevatorBorderColor--);
        border-radius: 50%;
        outline: none;
        cursor: pointer;
        background-color: var(--elevatorBtnBgColor--);
      }
      /* //éœ€è¦ç»™æŒ‰é’®æ·»åŠ ä¸€ä¸ªé€‰ä¸­æ ·å¼æ•ˆæœ */
      .checked {
        border: 1px solid red;
        color: red;
      }
      /* //åŠ ç‚¹ä¸Šé—´è· */
      .ew-elevator-btn:last-of-type {
        margin-top: 8px;
      }
      /* //æŒ‰é’®ç¦ç”¨ */
      .ew-elevator-btn[disabled] {
        cursor: not-allowed;
        background-color: var(--elevatorBtnBgDisabledColor--);
        color: var(--elevatorBtnDisabledColor--);
      }
      /* //æ¥¼å±‚æ•°æ ·å¼ */
      .ew-elevator-count {
        width: 80px;
        height: 98px;
        text-align: center;
        font: 56px / 98px 'å¾®è½¯é›…é»‘', 'æ¥·ä½“';
      }
    </style>
  </head>
  <body>
    <div class="ew-elevator-building">
      <!--ç”µæ¢¯äº•-->
      <div class="ew-elevator-shaft">
        <!--ç”µæ¢¯-->
        <div class="ew-elevator">
          <!--ç”µæ¢¯å·¦å³é—¨-->
          <div class="ew-elevator-left-door ew-elevator-door"></div>
          <div class="ew-elevator-right-door ew-elevator-door"></div>
        </div>
      </div>
      <div class="ew-elevator-storey-zone">
        <div class="ew-elevator-storey">
          <!--ç”µæ¢¯æŒ‰é’®ï¼ŒåŒ…å«ä¸Šå‡æŒ‰é’®å’Œä¸‹é™æŒ‰é’®-->
          <div class="ew-elevator-controller">
            <button
              type="button"
              class="ew-elevator-to-top ew-elevator-btn"
              onclick="upstairsBtn(event)"
            >
              â†‘
            </button>
            <button
              type="button"
              class="ew-elevator-to-bottom ew-elevator-btn"
              onclick="downstairsBtn(event) "
            >
              â†“
            </button>
          </div>
          <!--æ¥¼å±‚æ•°-->
          <div class="ew-elevator-count">5</div>
        </div>
        <div class="ew-elevator-storey">
          <!--ç”µæ¢¯æŒ‰é’®ï¼ŒåŒ…å«ä¸Šå‡æŒ‰é’®å’Œä¸‹é™æŒ‰é’®-->
          <div class="ew-elevator-controller">
            <button
              type="button"
              class="ew-elevator-to-top ew-elevator-btn"
              onclick="upstairsBtn(event)"
            >
              â†‘
            </button>
            <button
              type="button"
              class="ew-elevator-to-bottom ew-elevator-btn"
              onclick="downstairsBtn(event) "
            >
              â†“
            </button>
          </div>
          <!--æ¥¼å±‚æ•°-->
          <div class="ew-elevator-count">4</div>
        </div>
        <div class="ew-elevator-storey">
          <!--ç”µæ¢¯æŒ‰é’®ï¼ŒåŒ…å«ä¸Šå‡æŒ‰é’®å’Œä¸‹é™æŒ‰é’®-->
          <div class="ew-elevator-controller">
            <button
              type="button"
              class="ew-elevator-to-top ew-elevator-btn"
              onclick="upstairsBtn(event)"
            >
              â†‘
            </button>
            <button
              type="button"
              class="ew-elevator-to-bottom ew-elevator-btn"
              onclick="downstairsBtn(event) "
            >
              â†“
            </button>
          </div>
          <!--æ¥¼å±‚æ•°-->
          <div class="ew-elevator-count">3</div>
        </div>
        <div class="ew-elevator-storey">
          <!--ç”µæ¢¯æŒ‰é’®ï¼ŒåŒ…å«ä¸Šå‡æŒ‰é’®å’Œä¸‹é™æŒ‰é’®-->
          <div class="ew-elevator-controller">
            <button
              type="button"
              class="ew-elevator-to-top ew-elevator-btn"
              onclick="upstairsBtn(event)"
            >
              â†‘
            </button>
            <button
              type="button"
              class="ew-elevator-to-bottom ew-elevator-btn"
              onclick="downstairsBtn(event) "
            >
              â†“
            </button>
          </div>
          <!--æ¥¼å±‚æ•°-->
          <div class="ew-elevator-count">2</div>
        </div>
        <div class="ew-elevator-storey">
          <!--ç”µæ¢¯æŒ‰é’®ï¼ŒåŒ…å«ä¸Šå‡æŒ‰é’®å’Œä¸‹é™æŒ‰é’®-->
          <div class="ew-elevator-controller">
            <button
              type="button"
              class="ew-elevator-to-top ew-elevator-btn"
              onclick="upstairsBtn(event)"
            >
              â†‘
            </button>
            <button
              type="button"
              class="ew-elevator-to-bottom ew-elevator-btn"
              onclick="downstairsBtn(event) "
            >
              â†“
            </button>
          </div>
          <!--æ¥¼å±‚æ•°-->
          <div class="ew-elevator-count">1</div>
        </div>
      </div>
    </div>
  </body>
  <script>

    // æœ‰bugå¾…ä¿®å¤

    // å¾…æ·»åŠ çš„åŠŸèƒ½
    // 1. æ˜¾ç¤ºå½“å‰æ¥¼å±‚
    // 2. å½“å‰æ¥¼å±‚ç‚¹å‡»æŒ‰é’®, è‡ªåŠ¨å¼€é—¨
    const runTime = 2000 // ç”µæ¢¯è¿è¡Œæ—¶é—´
    const openDoorTime = 500 // å¼€é—¨æ—¶é—´
    const closeDoorTime = 500 // å…³é—¨æ—¶é—´
    let currentStorey = 1 // å½“å‰æ¥¼å±‚
    let clientStoreyArr = [
      // {
      //   value: 5,
      //   direction: 'up'
      // },
      // {
      //   value: 3,
      //   direction: 'up'
      // },
      // {
      //   value: 2,
      //   direction: 'down'
      // },
      // {
      //   value: 1,
      //   direction: 'down'
      // }
    ] // å®¢æˆ·ç‚¹å‡»çš„æ¥¼å±‚
    let nextStorey = null // ç”µæ¢¯ä¸‹ä¸€æ¬¡åˆ°çš„æ¥¼å±‚
    let elevatorDoor = true // ç”µæ¢¯é—¨æ˜¯å¦å¼€å¯
    let elevatorDirection = 'up'

    // ä¸ŠæŒ‰é’®
    function upstairsBtn(e) {
      const parentNode = e.target.parentNode.parentNode
      // æ¥¼å±‚
      const count = $(parentNode).find('.ew-elevator-count').text()
      let obj = {
        direction: 'up',
        value: count
      }
      let exist = clientStoreyArr.find((item) => {
        return item.value === obj.value && item.direction === obj.direction
      })
      if (!exist) {
        clientStoreyArr.push(obj)
        $(e.target).addClass('checked')
      }
    }
    //ä¸‹æŒ‰é’®
    function downstairsBtn(e) {
      const parentNode = e.target.parentNode.parentNode
      // æ¥¼å±‚
      const count = $(parentNode).find('.ew-elevator-count').text()
      let obj = {
        direction: 'down',
        value: count
      }
      let exist = clientStoreyArr.find((item) => {
        return item.value === obj.value && item.direction === obj.direction
      })
      if (!exist) {
        clientStoreyArr.push(obj)
        $(e.target).addClass('checked')
      }
    }

    function init() {
      console.log('run')
      // ç”µæ¢¯çš„è§„åˆ™
      // 0. æ²¡æœ‰äººæŒ‰ç”µæ¢¯, ç”µæ¢¯åœæ­¢
      // 1. ç”µæ¢¯æœä¸€ä¸ªæ–¹å‘è¿è¡Œ, åˆ°è¾¾åº•å±‚æˆ–é¡¶å±‚å, æ¢æ–¹å‘
      // 2. ç”µæ¢¯åˆ°è¾¾æŒ‡å®šå±‚ä¼šæ‰“å¼€é—¨, æ¶ˆé™¤æŒ‰é”®æŒ‡ç¤º, ç„¶åå…³é—¨ååœ¨è¿è½¬.
      //
      if (clientStoreyArr.length == 0 && nextStorey === null) {
        // ç”µæ¢¯åœæ­¢
        return
      }
      // ç”µæ¢¯ä¸‹ä¸ªæ¥¼å±‚ä¸ºç©º, æŸ¥æ‰¾å®¢æˆ·ç‚¹å‡»æ¥¼å±‚
      if (!nextStorey) {
        nextStorey = findRunStorey()
      }
      // ç”µæ¢¯è¿è¡ŒæŒ‡å®šæ¥¼å±‚
      start()
    }
    function start() {
      // è§†å›¾æ˜¾ç¤ºæŒ‡å®šæ¥¼å±‚
      runAnimation()
      currentStorey = nextStorey
      // æ¸…é™¤ç”µæ¢¯ä¸‹ä¸€æ­¥åˆ°è¾¾çš„æ¥¼å±‚
      nextStorey = null
    }
    function runAnimation() {
      // ç”µæ¢¯ä¸Šä¸‹ç§»åŠ¨
      // å¼€å…³é—¨
      // åˆ°è¾¾çš„æ¥¼å±‚æ¸…é™¤æŒ‰é’®
      const height = 98
      const removePx = `${height * (nextStorey - 1)}px`
      $('.ew-elevator').css('bottom', removePx)

      let nextStoreyObj = {
        direction: elevatorDirection,
        value: nextStorey
      }
      // æ¸…é™¤æŒ‰é’®æŒ‡ç¤º
      removeBtnClass(nextStoreyObj)

      // å¼€å…³é—¨åŠ¨ç”»
      setTimeout(() => {
        $('.ew-elevator-left-door').css('left', '-92px')
        $('.ew-elevator-right-door').css('right', '-92px')
        setTimeout(() => {
          $('.ew-elevator-left-door').css('left', '0px')
          $('.ew-elevator-right-door').css('right', '0px')
        }, closeDoorTime)
      }, openDoorTime)
    }
    function findRunStorey() {
      // è¿”å›ä¸‹ä¸€æ¬¡åˆ°è¾¾çš„æ¥¼å±‚
      if (clientStoreyArr.length == 0) {
        return null
      }
      let index = -1
      // åªæœ‰æœ‰äººç‚¹å‡»æ¥¼å±‚, ä¸‹ä¸€æ¬¡ç§»åŠ¨çš„æ¥¼å±‚index
      if (elevatorDirection == 'up') {
        index = findUpstairsIndex()
        elevatorDirection = index === -1 ? 'down' : 'up'
      } else {
        index = findDownstairsIdenx()
        elevatorDirection = index === -1 ? 'up' : 'down'
      }
      // å‘ä¸ŠæŸ¥æ‰¾ä¸€æ¬¡æ²¡æœ‰ç»“æœ, åå‘æŸ¥æ‰¾ä¸€æ¬¡
      if (index === -1 && clientStoreyArr.length !== 0) {
        if (elevatorDirection == 'down') {
          index = findDownstairsIdenx()
        } else {
          index = findUpstairsIndex()
        }
      }
      return clientStoreyArr.splice(index, 1)[0].value
    }
    function findUpstairsIndex() {
      let index = -1
      if (elevatorDirection == 'up') {
        // æ‰¾å‡ºå‘ä¸Šæ–¹å‘å’Œåœ¨å½“å‰æ¥¼å±‚ä¹‹ä¸Šçš„å±‚æ•°
        let arr = clientStoreyArr.filter(
          (item) => item.direction === 'up' && item.value > currentStorey
        )
        if (arr.length > 0) {
          // æ¥¼å±‚å°åˆ°å¤§æ’åº
          arr = arr.sort((a, b) => a.value - b.value)
          index = clientStoreyArr.findIndex((item) => {
            // ç”µæ¢¯ä¸Šè¡Œçš„æ—¶å€™
            return item.value === arr[0].value
          })
        }
        return index
      }
    }
    function findDownstairsIdenx() {
      let index = -1
      if (elevatorDirection == 'down') {
        // æ‰¾å‡ºå‘ä¸‹æ–¹å‘å’Œåœ¨å½“å‰æ¥¼å±‚ä¹‹ä¸‹çš„å±‚æ•°
        let arr = clientStoreyArr.filter(
          (item) => item.direction === 'down' && item.value < currentStorey
        )
        if (arr.length > 0) {
          // æ¥¼å±‚å°åˆ°å¤§æ’åº
          arr = arr.sort((a, b) => b.value - a.value)
          index = clientStoreyArr.findIndex((item) => {
            // ç”µæ¢¯ä¸Šè¡Œçš„æ—¶å€™
            return item.value === arr[0].value
          })
        }
        return index
      }
    }
    function removeBtnClass(obj) {
      const el = Array.from($('.ew-elevator-count')).find((item) => {
        return item.innerHTML == obj.value
      })
      console.log("ğŸš€ ~ el ~ el", $(el.parentNode).find('.ew-elevator-to-top'))

      if (obj.direction === 'up') {
        $(el.parentNode).find('.ew-elevator-to-top').removeClass('checked')
      }else{
        $(el.parentNode).find('.ew-elevator-to-bottom').removeClass('checked')
      }
    }
    setInterval(init, runTime)
  </script>
</html>
